name: "Rust Setup"
description: "Sets up Rust with sccache and caching"

runs:
  using: "composite"
  steps:
    - name: Configure runtime env
      shell: bash
      run: |
        echo "RUSTC_WRAPPER=sccache" >> $GITHUB_ENV  
        echo "SCCACHE_GHA_ENABLED=true" >> $GITHUB_ENV 
        echo "RUST_BACKTRACE=1" >> $GITHUB_ENV
        echo "RUSTFLAGS=-C debuginfo=line-tables-only -C incremental=false" >> $GITHUB_ENV

    - name: Cache Rust compilation
      uses: metalbear-co/sccache-action@v1
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        # Optional, default is `sccache-`
        cache-from: sccache-${{ runner.os }}-
        # Optional, default is `sccache-latest`
        cache-to: sccache-${{ runner.os }}-${{ github.sha }}

    - name: Install Rust toolchain
      uses: dtolnay/rust-toolchain@master
      with:
        components: rustfmt, clippy, rust-src
        toolchain: nightly-2025-01-24

